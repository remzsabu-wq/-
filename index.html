<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>2D Shooting</title>
<style>
  body { margin: 0; background: #000; overflow: hidden; }
  canvas { display: block; margin: auto; background: #000; }
</style>
</head>
<body>

<canvas id="game" width="480" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* =====================
   画像まとめロード
===================== */
const images = {};
const imageFiles = {
  player: "images/player.png",
  enemy:  "images/enemy.png",
  bullet: "images/bullet.png",
  bg:     "images/bg.png"
};

let loaded = 0;
const total = Object.keys(imageFiles).length;

for (const key in imageFiles) {
  const img = new Image();
  img.src = imageFiles[key];
  img.onload = () => {
    loaded++;
    if (loaded === total) startGame();
  };
  images[key] = img;
}

/* =====================
   ゲーム開始
===================== */
let player, bullets, enemies;

function startGame() {
  player = { x: 220, y: 520, w: 40, h: 40 };
  bullets = [];
  enemies = [];

  setInterval(() => {
    enemies.push({
      x: Math.random() * 440,
      y: -40,
      w: 40,
      h: 40,
      vy: 2
    });
  }, 1000);

  requestAnimationFrame(loop);
}

/* =====================
   操作
===================== */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") player.x -= 10;
  if (e.key === "ArrowRight") player.x += 10;
  if (e.key === " ") {
    bullets.push({ x: player.x + 18, y: player.y });
  }
});

/* =====================
   ループ
===================== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

function update() {
  bullets.forEach(b => b.y -= 8);
  enemies.forEach(e => e.y += e.vy);

  bullets = bullets.filter(b => b.y > -20);
  enemies = enemies.filter(e => e.y < 700);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 背景
  ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);

  // 自機
  ctx.drawImage(images.player, player.x, player.y, player.w, player.h);

  // 弾
  bullets.forEach(b => {
    ctx.drawImage(images.bullet, b.x, b.y, 8, 16);
  });

  // 敵
  enemies.forEach(e => {
    ctx.drawImage(images.enemy, e.x, e.y, e.w, e.h);
  });
}
</script>

</body>
</html>
